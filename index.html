<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <link rel="stylesheet" href="https://egkoppel.github.io/product-sans/google-fonts.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
  <div id="container" style="height:85px;">
  <h1 id="name" class="product-sans" style="width: 80%; height:100%; float:left; font-family:product-sans;-moz-font-feature-settings: 'liga=1';-ms-font-feature-settings: 'liga';-webkit-font-feature-settings: 'liga';-o-font-feature-settings: 'liga';font-feature-settings: 'liga';">
    Loading... <i id="icon" class="material-icons">refresh</i>
</h1>

<h3 id="message" class="product-sans" style="width: 20%; height:100%; float:right; font-family:product-sans;-moz-font-feature-settings: 'liga=1';-ms-font-feature-settings: 'liga';-webkit-font-feature-settings: 'liga';-o-font-feature-settings: 'liga';font-feature-settings: 'liga';">
   Loading...
</h3>
  </div>
<script>
 
  function range(start, stop, step) {
    if (typeof stop == 'undefined') {
        // one param defined
        stop = start;
        start = 0;
    }

    if (typeof step == 'undefined') {
        step = 1;
    }

    if ((step > 0 && start >= stop) || (step < 0 && start <= stop)) {
        return [];
    }

    var result = [];
    for (var i = start; step > 0 ? i < stop : i > stop; i += step) {
        result.push(i);
    }

    return result;
};
  
  function* entries(obj) {
  for (let key of Object.keys(obj)) {
    yield [key, obj[key]];
  }  
}
  
  var message = "";
  var status = 3;
  var nameText = document.getElementById('name');
  var iconText = document.getElementById('icon');
  var messageText = document.getElementById('message');
  var container = document.getElementById('container');
  var names = [];
  var urls = [];
  
  $.get( "view.json", function( data ) {
    clear();
    console.log(data);
    var i = 0;
for (let [key, value] of entries(data)) {
  names[i] = key;
    urls[i] = value;
    nameText.innerHTML = key + "  <i id=\"icon\" class=\"material-icons\">refresh</i>";
    iconText = document.getElementById('icon');
    console.log(value);
    console.log(key);
  i++;
}
    console.log(names);
    console.log(urls);
});
  
  //TODO: work on this bit
  for (i = 0; i < names.length; i++) {
    $.get( "https://api.travis-ci.org/repos/" + urls[i] + ".json", function( data ) {
  if(data["last_build_status"] != null) {
    status = data["last_build_status"];
  } else {
    status = 2;
  }
});
  $.get( "https://api.travis-ci.org/repos/" + urls[i] + "/builds", function( data ) {
  message = data[0]['message'];
});
  update(names[i]);
  }
  
setInterval(function() {
  clear();
  for (let [key, value] of entries(data)) {
  names[i] = key;
    urls[i] = value;
    nameText.innerHTML = key + "  <i id=\"icon\" class=\"material-icons\">refresh</i>";
    iconText = document.getElementById('icon');
    console.log(value);
    console.log(key);
  i++;
}
    console.log(names);
    console.log(urls);
  
  for (i = 0; i < names.length; i++) {
    $.get( "https://api.travis-ci.org/repos/" + urls[i] + ".json", function( data ) {
  if(data["last_build_status"] != null) {
    status = data["last_build_status"];
  } else {
    status = 2;
  }
});
  $.get( "https://api.travis-ci.org/repos/" + urls[i] + "/builds", function( data ) {
  message = data[0]['message'];
});
  update(names[i]);
  }
}, 10000);

  function update(name) {
    var color = "";
    var icon = "";
    if (status == 0) {
      color = "#3ed850";
      icon = "done";
    } else if (status == 1) {
      color = "#ff4242";
      icon = "bug_report";
    } else if (status == 2) {
      color = "#42b9ff";
      icon = "build";
    } else {
      color = "#9b9b9b";
      icon = "refresh";
    }
    document.body.innerHTML = document.body.innerHTML + `<div id="container" style="height:85px;background-color:` + color + `;">
  <h1 id="name" class="product-sans" style="position: relative;top: 50%;transform: translateY(-50%); width: 80%; height:100%; float:left; font-family:product-sans;-moz-font-feature-settings: 'liga=1';-ms-font-feature-settings: 'liga';-webkit-font-feature-settings: 'liga';-o-font-feature-settings: 'liga';font-feature-settings: 'liga';">
    ` + name + ` <i id="icon" class="material-icons">` + icon + `</i>
</h1>

<h3 id="message" class="product-sans" style="position: relative;top: 50%;transform: translateY(-50%); width: 20%; height:100%; float:right; font-family:product-sans;-moz-font-feature-settings: 'liga=1';-ms-font-feature-settings: 'liga';-webkit-font-feature-settings: 'liga';-o-font-feature-settings: 'liga';font-feature-settings: 'liga';">
   ` + message + `
</h3>
  </div>`;
    
  }
  
  function clear() {
    document.body.innerHTML = "";
  }
</script>
</body>
</html>
