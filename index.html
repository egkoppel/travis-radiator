<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <link rel="stylesheet" href="https://egkoppel.github.io/product-sans/google-fonts.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
  <div id="container" style="height:85px;">
  <h1 id="name" class="product-sans" style="position: relative;top: 50%;transform: translateY(-50%); width: 80%; height:100%; float:left; font-family:product-sans;-moz-font-feature-settings: 'liga=1';-ms-font-feature-settings: 'liga';-webkit-font-feature-settings: 'liga';-o-font-feature-settings: 'liga';font-feature-settings: 'liga';">
    Loading... <i id="icon" class="material-icons">refresh</i>
</h1>

<h3 id="message" class="product-sans" style="position: relative;top: 50%;transform: translateY(-50%); width: 20%; height:100%; float:right; font-family:product-sans;-moz-font-feature-settings: 'liga=1';-ms-font-feature-settings: 'liga';-webkit-font-feature-settings: 'liga';-o-font-feature-settings: 'liga';font-feature-settings: 'liga';">
   Loading...
</h3>
  </div>
<script>
 
  function* entries(obj) {
  for (let key of Object.keys(obj)) {
    yield [key, obj[key]];
  }  
}
  
  var message = "";
  var status = 3;
  var nameText = document.getElementById('name');
  var iconText = document.getElementById('icon');
  var messageText = document.getElementById('message');
  var container = document.getElementById('container');
  var name = "";
  var url = "";
  
  $.get( "view.json", function( data ) {
    console.log(data);
  for (let [key, value] of entries(data)) {
  name = key;
    url = value;
    nameText.innerHTML = name + "  <i id=\"icon\" class=\"material-icons\">refresh</i>";
    iconText = document.getElementById('icon');
    console.log(url);
    console.log(name);
    $.get( "https://api.travis-ci.org/repos/" + url + ".json", function( data ) {
  if(data["last_build_status"] != null) {
    status = data["last_build_status"];
  } else {
    status = 2;
  }
});
  $.get( "https://api.travis-ci.org/repos/" + url + "/builds", function( data ) {
  message = data[0]['message'];
});
  update();
  
setInterval(function() {
  $.get( "https://api.travis-ci.org/repos/" + url + ".json", function( data ) {
  if(data["last_build_status"] != null) {
    status = data["last_build_status"];
  } else {
    status = 2;
  }
});
  $.get( "https://api.travis-ci.org/repos/" + url + "/builds", function( data ) {
  message = data[0]['message'];
});
  update();
}, 10000);
}
});
  
  
  
  console.log('test');

  function update() {
    if (status == 0) {
      container.style.backgroundColor = "#3ed850";
      iconText.innerHTML = "done";
    } else if (status == 1) {
      container.style.backgroundColor = "#ff4242";
      iconText.innerHTML = "bug_report";
    } else if (status == 2) {
      container.style.backgroundColor = "#42b9ff";
      iconText.innerHTML = "build";
    } else {
      container.style.backgroundColor = "#9b9b9b";
      iconText.innerHTML = "refresh";
    }
    messageText.innerHTML = message;
  }
</script>
</body>
</html>
